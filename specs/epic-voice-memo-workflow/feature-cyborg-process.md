# Feature: Cyborg Process Command

## Overview

Create `/cyborg.process` slash command that processes queued voice memos into brain notes compatible with Cyborg's knowledge management system.

## User Story

As a developer using Cyborg, after recording voice memos, I want to process them into brain notes so that the knowledge is searchable and integrated with my brain regenerate workflow.

## Context

Similar to `/aura.process`, but instead of moving to `.aura/output/`, this command:
1. Converts transcript to brain-compatible format
2. Adds relevant tags for searchability
3. Moves to `brain/` directory
4. Ensures compatibility with Cyborg regenerate

This enables capturing knowledge via voice and having it indexed in your brain.

## Command Specification

**Location**: `.claude/commands/cyborg.process.md`

**Allowed Tools**:
- `Read` - Read transcript files
- `Glob` - Find queued memos
- `Write` - Create brain notes
- `Bash(mv:*)` - Move files
- `Bash(ls:*)` - List directories

**Description**: Process voice memos into brain notes

**Argument Hint**: `[memo-title] | --all`

## Command Workflow

### 1. Discovery Phase

```markdown
## Step 1: Find Queued Memos

Use Glob to find all directories in `.aura/queue/`:

```bash
ls .aura/queue/
```

List found memos to user.

If no memos found, inform user and exit.
```

### 2. Selection Phase

```markdown
## Step 2: Select Memo to Process

If user provided memo title as argument:
- Validate it exists in queue
- Process that memo only

If user provided `--all`:
- Process all queued memos in sequence

If no argument:
- Ask user to specify memo title or use `--all`
```

### 3. Intent & Content Analysis

```markdown
## Step 3: Analyze Transcript for Brain Note

Read `transcript.txt` from memo directory.

Analyze for:
1. **User Intent**: Is there a specific request? (research, summary, etc.)
2. **Key Concepts**: What technical terms, names, or topics appear?
3. **Auto-Tags**: Generate relevant tags from content

Unlike Aura process, focus on knowledge extraction:
- What facts or insights are present?
- What questions are asked?
- What connections to other concepts?
```

### 4. Brain Note Creation

```markdown
## Step 4: Create Brain Note

Create a brain note with this structure:

```markdown
---
title: <generated-title>
created: <ISO 8601 timestamp>
tags: [<auto-generated tags>]
source: voice-memo
audio: ../.aura/output/<title>/audio.wav
---

# <Title>

## Content

<Processed transcript content>

### Key Insights

<Extracted key points or insights>

### Questions

<Any questions raised in the memo>

### Related Topics

<Tags and related concepts>

## Original Transcript

<Raw transcript for reference>

## Metadata

- **Recorded**: <timestamp>
- **Duration**: <if available>
- **Intent**: <detected intent>
```

Apply intent-based transformations if needed:
- Research intent → include findings or links
- Code intent → format code blocks
- Summary intent → condense to key points
- Default → clean and structure content
```

### 5. Auto-Tagging

```markdown
## Step 5: Generate Tags

Extract tags from:
1. **Intent**: research, code, summary, etc.
2. **Technical Terms**: API names, languages, frameworks
3. **Action Words**: implement, refactor, fix, design
4. **Domain Concepts**: authentication, frontend, testing
5. **Temporal**: Year-month (2026-01)
6. **Source**: Always include `voice-memo`

Example:
Transcript: "Research OAuth implementation patterns"
Tags: [research, oauth, authentication, security, implementation, voice-memo, 2026-01]

Show generated tags to user.
```

### 6. Brain Directory Placement

```markdown
## Step 6: Move to Brain Directory

Create brain note file in `brain/<title>.md`:

```bash
# Ensure brain directory exists
mkdir -p brain

# Write the brain note
# (use Write tool to create brain/<title>.md)
```

Copy audio file for reference:
```bash
mkdir -p .aura/output/<title>
cp .aura/queue/<title>/audio.wav .aura/output/<title>/
```

Move original queue directory to output:
```bash
mv .aura/queue/<title> .aura/output/
```

Update audio path in brain note frontmatter to point to output location.
```

### 7. Verification

```markdown
## Step 7: Verify Brain Note

Verify:
- [ ] Brain note exists: `brain/<title>.md`
- [ ] Frontmatter is valid YAML
- [ ] Tags are relevant
- [ ] Content is formatted
- [ ] Audio preserved in output

Show user:
- Brain note location: `brain/<title>.md`
- Tag list
- Next steps: "Run `brain regenerate` to update index"
```

## Implementation Tasks

- [ ] Create `.claude/commands/cyborg.process.md` with frontmatter
- [ ] Implement discovery phase (same as aura.process)
- [ ] Implement content analysis and insight extraction
- [ ] Implement auto-tagging logic
- [ ] Implement brain note creation with frontmatter
- [ ] Implement file movement and organization
- [ ] Add verification step
- [ ] Test with Cyborg's brain regenerate
- [ ] Handle edge cases (tag collisions, title conflicts)

## Acceptance Criteria

- [ ] Command lists queued memos
- [ ] Command processes specific or all memos
- [ ] Brain notes created with valid frontmatter
- [ ] Tags are relevant and searchable
- [ ] Content is well-structured and readable
- [ ] Audio preserved in output directory
- [ ] Queue directory moved to output after processing
- [ ] Brain notes work with `brain regenerate`
- [ ] Manual edits to brain notes persist
- [ ] Clear success messages with next steps

## Example Usage

### Process Single Memo

```
User: /cyborg.process oauth-research

Agent: Processing memo: oauth-research

Analyzing transcript...
Detected intent: research
Key concepts: OAuth 2.0, JWT, authentication, security

Generating tags: [research, oauth, jwt, authentication, security, voice-memo, 2026-01]

Creating brain note...
Writing to: brain/oauth-research.md

Preserving audio: .aura/output/oauth-research/audio.wav
Moving queue to output...

✓ Brain note created: brain/oauth-research.md
✓ Tags: research, oauth, jwt, authentication, security, voice-memo, 2026-01

Next: Run `brain regenerate` to update index
```

### Process All Memos

```
User: /cyborg.process --all

Agent: Found 3 queued memos. Processing...

1/3: oauth-research (intent: research)
  ✓ brain/oauth-research.md
  Tags: research, oauth, authentication

2/3: bug-fix-notes (intent: default)
  ✓ brain/bug-fix-notes.md
  Tags: bug-fix, authentication, voice-memo

3/3: code-pattern-idea (intent: code)
  ✓ brain/code-pattern-idea.md
  Tags: code, patterns, architecture

All memos processed!

Next: Run `brain regenerate` to update index
```

## Testing Plan

### Manual Testing

1. **Basic Brain Note Creation**:
   ```bash
   # Record memo in Cyborg project
   python .aura/scripts/record_memo.py
   # Say: "Research message queuing patterns for distributed systems"

   # Process
   /cyborg.process <title>

   # Verify brain note structure
   cat brain/<title>.md
   ```

2. **Tag Generation Test**:
   ```bash
   # Record memo with technical terms
   # Process and verify tags are relevant
   grep "tags:" brain/<title>.md
   ```

3. **Regenerate Compatibility Test**:
   ```bash
   # Process memo
   /cyborg.process <title>

   # Run brain regenerate
   brain regenerate

   # Verify note is indexed and searchable
   ```

4. **Multiple Memos Test**:
   ```bash
   # Record 3 memos
   /cyborg.process --all

   # Verify all brain notes created
   ls brain/
   ```

### Integration Testing

1. Record → Process → Regenerate → Search workflow
2. Manual edit brain note → Regenerate → Verify changes persist
3. Process same memo in both Aura and Cyborg contexts
4. Test tag-based search across multiple brain notes

## Documentation Updates

- [ ] Add `/cyborg.process` to Cyborg README
- [ ] Document brain note format in Cyborg docs
- [ ] Add workflow diagram to CLAUDE.md
- [ ] Update integration guide for Aura + Cyborg

## Dependencies

- Must complete: [Chore: Brain Note Format](./chore-brain-note-format.md)
- Must complete: [Chore: Queue Directory Structure](./chore-queue-structure.md)
- Uses: Intent detection logic from Aura process
- Creates: Brain notes in `brain/` directory
- Integrates: Cyborg's brain regenerate system

## Edge Cases

1. **No Brain Directory**: Create it automatically
2. **Title Collision**: Append timestamp suffix
3. **Invalid Tags**: Sanitize (lowercase, alphanumeric + hyphen)
4. **Empty Transcript**: Warn user, create minimal brain note
5. **Very Long Transcript**: Full content in note, brief summary in frontmatter
6. **Special Characters in Title**: Sanitize for filename safety

## Future Enhancements

- Interactive tag editing before creation
- Suggest related existing brain notes based on tags
- Auto-link to related notes in content
- Extract actionable items → create Beads tickets
- Support for hierarchical tags (category/subcategory)
- Brain note templates by intent type
- Bulk re-tagging of existing brain notes
- Tag synonym support (oauth = OAuth 2.0 = oauth2)
